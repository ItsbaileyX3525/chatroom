<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
        <title>Bailey's chatroom</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="https://kit.fontawesome.com/e33e38ee00.js" crossorigin="anonymous"></script>
        <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
        <link rel="stylesheet" href="static/index.css">
        <link href='https://unpkg.com/boxicons@2.1.1/css/boxicons.min.css' rel='stylesheet'>
        <meta property="og:title" content="Bailey's chatroom">
        <meta property="og:description" content="Welcome to the chatroom of Bailey, talk discuss and do whatever!">
        <meta property="og:image" content="https://i.ibb.co/rpgNnkK/image.png">
</head>
<body data-theme="dark">
    <div id="notification">This is a custom notification!</div>
    <div id="chat-box">
        {% for message in messages %}
            <p class="chat-message">
                    <span class="date">{{ message[2] }}</span>
                    <span class="username" style="color: var({{ message[3] }})">{{ message[0] }}:</span>
                    <span class="message">{{ message[1]|safe }}</span>
            </p>
        {% endfor %}

    </div>
    <nav class="sidebar close">
        <header>
            <div class="image-text">
                <span class="image">
                    <img id="iconThing" src="{{ url_for('static', filename='favicon.ico') }}" alt="">
                </span>
                <div class="text logo-text">
                    <span id="usernameName" class="name">Username</span>
                    <span class="profession">Welcome!</span>
                </div>
            </div>
            <i class='bx bx-chevron-right toggle'></i>
        </header>
        <div class="menu-bar">
            <div class="menu">
                <ul class="menu-links">
                    <li class="nav-link">
                           <span class="text nav-text" id="RoomCode">Room code: Public (1)</span>
                    </li>
                    <li class="nav-link">
                        <span class="text nav-text">Play sound:<br style="display: none;" id="ForMobile">
                                <select class="selection" name="sounds" id="play_sounds"> 
                                    <option value="pluh">Pluh</option> 
                                    <option value="whatDaDogDoin">Dog doin?</option> 
                                    <option value="mew">Mew</option> 
                                    <option value="clang">Clang</option> 
                                    <option value="boom">Boom</option> 
                                    <option value="gay">Gay</option> 
                                    <option value="hellNaw">Hell naw!</option> 
                                </select><br id="ForDesktop">
                                <button class="play-button" role="button">Play</button>
                        </span>
                 </li>
                 <li class="nav-link">
                    <span class="text nav-text">Set colour: <br style="display: none;" id="ForMobile2">
                        <select class="selection" name="colours" id="set_colour"> 
                            <option value="blue">Blue</option> 
                            <option value="green">Green</option> 
                            <option value="dBlue">Dark blue</option> 
                            <option value="purple">Purple</option> 
                            <option value="orange">Orange</option> 
                            <option value="permanentGeraniumLake">Red</option> 
                        </select>
                    </span>
                 </li>
                 <li class="nav-link">
                    <span class="text nav-text">Join room: <br style="display: none;" id="ForMobile3">
                        <input maxlength="5" id="RoomInput" style="width: 20%;"></input><br id="ForDeskop2">
                        <button class="play-button" id="joinRoom" role="button" style="width: 70%;">Join</button>
                    </span>
                 </li><li class="nav-link"></li>
                 <li class="nav-link">
                    <span class="text nav-text" id="ChatroomThemeText">Chatroom theme:<br id="ForDeskop2">
                            <select class="selection" name="themes" id="client_theme"> 
                                <option value="dark">Dark</option> 
                                <option value="light">Light</option> 
                                <option value="anime">Anime</option> 
                                <option value="cod">Call of Duty</option> 
                            </select>
                    </span>
             </li>
                </ul>
            </div>
            <div class="bottom-content">
                <li class="">
                    <i style="cursor: pointer;" onclick="Logout()" class='bx bx-log-out icon' ></i>
                   <span class="text nav-text" style="cursor: pointer;" onclick="Logout()">Logout</span>
                </li>
                <li class="mode">
                    <div class="chatroom-version">Chatroom version: {{ version }}</div>
                </li>
                
            </div>
        </div>
    </nav>

    <div class="container-update" id="containerUpdate">
        <div class="update-container">
            <h1>Update Log</h1>
            <span id="closeUpdateLog"><p>X</p></span>
            <div class="updates">
                <h3>Update 5.1</h3>
                <li>Impoved code maintainability by a lot...</li>
                <li>Fixed some broken code</li>
                <li>Added indication if you lost connection</li>
                <h3>Update 5.0 - Theme update</h3>
                <li>Added chatroom themes</li>
                <h3>Update 4.9 - Return of the fixes</h3>
                <li>Fixed an issue where custom sound wouldn't work in public room.</li>
                <li>Fixed username colour changing when sending an image.</li>
                <li>And fixed username colours on custom chatrooms... I think?</li>
                <h3>Update 4.8 - Image pasting</h3>
                <li>Added support for image pasting.</li>
                <li>Updated the nav bar.</li>
                <li>Can join custom room without logging out.</li>
                <h3>Update 4.5 - Sidebar nav</h3>
                <li>Added a sidebar navigation for ease of use.</li>
                <h3>Update 4.1 - Image supporting</h3>
                <li>Added support for every image, gifs included!</li>
                <li>Fixed a few memory leaks improving memory usage.</li>
                <li>Data streaming added so images load smoothly.</li>
                <li>Added the cursor pointer to image uploading.</li>
                <li>Fixed the banning system so wrong users don't get banned.</li>
                <li>Added help for colour types and displaying all colours.</li>
                <h3>Update 4 - The APK and EXE update.</h3>
                <li>Created a build for windows and linux. (exe and sh)</li>
                <li>Created an apk for mobile <a target="_blank" href="https://github.com/ItsbaileyX3525/chatroom/raw/master/build/Chatroom.apk" style="color: salmon;">HERE.</a></li>
                <li>Added a custom sound max length to public room.</li>
                <h3>Update 3.5</h3>
                <li>Increased chat limit to 250 chars.</li>
                <li>Custom chatrooms now save.</li>
                <li>Custom chatroom username colours have been fixed.</li>
                <li>Notify user that the username colour has reset.</li>
                <h3>Update 3.2</h3>
                <li>Fixed image uploading.</li>
                <li>Added a limit to the username length.</li>
                <li>Added a limit to the length of your message. (may change)</li>
                <h3>Update 3.1</h3>
                <li>Fixed chatrooms going out of sync with server (maybe)</li>
                <li>Removed the ability to have spaces in username</li>
                <li>Custom rooms now save into a dict so can be rejoined whenever (messages don't save)</li>
                <h3>Update 3.0</h3>
                <li>Added custom chatrooms.</li>
                <li>Made mobile styles more consistant.</li>
                <li>Fixed rare bug that would cause mobile login/signup to break.</li>
                <h3>Update 2.6</h3>
                <li>Fixed chatroom styling wrong on smaller screens.</li>
                <li>Updated styling for update log on mobile.</li>
                <h3>Update 2.5</h3>
                <li>Added username colours.</li>
                <li>Optimised the server script to run faster.</li>
                <li>Fixed memory leaks caused by not closing a few databases when finished.</li>
                <li>Created update log.</li>
                <li>Created a <a target="_blank" href="https://www.buymeacoffee.com/ItsbaileyX3525">buy me a coffee page.</a></li>
                <h3>Update 2.3</h3>
                <li>Fixed bug to do with emojis</li>
                <li>Revamped how the functions were called and executed, improving the efficiency of the server.</li>
                <li>Removed the mobile styles and combined them with the desktop ones.</li>
                <li>Introduced the function send_system_message which significantly improved server responsiveness</li>
                <h3>Update 2.1</h3>
                <li>Optimsed server by adding certain function to the client instead of running from the server.</li>
                <li>Fixed /changePwd and /font not responding.</li>
                <li>Removed over 200 duplicate emojis from the emoji list which makes the chatroom load faster.</li>
                <li>Refactored the old code on the server</li>
                <li>Improved the responsiveness of the mobile styling on the login page and chatroom</li>
                <h3>Update 2.0</h3>
                <li>Redesigned the entire chatroom css. (contributed by Ano)</li>
                <li>Ban system has been added.</li>
                <li>Added 404 page in case you get lost.</li>
                <li>Improved the styling of the ban page.</li>
                <li>Fixed some serious secuirty bugs.</li>
                <li>Changed the site to a domain and enforced HTTPS.</li>
                <li>Added chatroom version tracker.</li>
                <li>Increased max data upload (image upload) to 16MB</li>
                <h3>Update 1.1</h3>
                <li>Fixed minor bugs related to the functions.</li>
                <h3>Update 1.0</h3>
                <li>Made the login page more modern.</li>
                <li>rewrote most of the code to be more readable/efficient.</li>            
            </div>
        </div>
    </div>
    <div class="container">
        <div class="file-upload-container">
            <label for="uploadImage" style="cursor: pointer;"><i class="fa-solid fa-circle-plus"></i></label>
            <input type='file' id="uploadImage" accept="image/*" onchange="handleUpload();"></input>
        </div>
        <textarea maxlength="240" id="messageInput" class="input-field" rows="3" placeholder="Type your message..."></textarea>
        <div class="send-button-container">
            <button id="sendButton" class="send-button">&#10148;</button>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.3.2/socket.io.js"></script>
    <script src="../static/index.js"></script>
    <script>
        const body = document.querySelector('body'),
      sidebar = body.querySelector('nav'),
      toggle = body.querySelector(".toggle"),
      searchBtn = body.querySelector(".search-box"),
      modeSwitch = body.querySelector(".toggle-switch"),
      modeText = body.querySelector(".mode-text");
      let onPhone = false
      let canSend = true
      let usernameText = document.getElementById("usernameName")
      let RoomCode = document.getElementById("RoomCode")
      const playSpace = document.getElementById("ForMobile")
      const playSpacePC = document.getElementById("ForDesktop")
      const colourSpace = document.getElementById("ForMobile2")
      const joinSpace = document.getElementById("ForMobile3")
      const joinSpacePC = document.getElementById("ForDeskop2")
      const iconThing = document.getElementById("iconThing")
      const textarea = document.getElementById("messageInput")
      const roomInput = document.getElementById("RoomInput")
      const joinRoom = document.getElementById("joinRoom")
      toggle.addEventListener("click" , () =>{
    sidebar.classList.toggle("close");
    if (iconThing.style.opacity == 0){
        onPhone = true
        if (window.innerWidth < 500 && window.innerHeight < 1000) {
            playButton.style.width="5%"
            playButton.innerText = "►"
            playSpace.style.display = "inline"
            colourSpace.style.display = "inline"
            joinSpace.style.display = "inline"
            joinSpacePC.style.display = "none"
            roomInput.style.width = "35%"
            joinRoom.style.width="50%"
            joinRoom.style.padding = "13px 11px"
            playSpacePC.style.display = "none"
            RoomCodeCode = RoomCode.innerText.slice(11)
            RoomCode.innerText = `Room code:\n ${RoomCodeCode}`
            if (usernameText.textContent.length > 8){
                usernameText.innerText = usernameText.textContent.slice(0, 8) + '\n' + usernameText.textContent.slice(8);
            } 
        }
        iconThing.style.opacity = 1
    }
    else if (iconThing.style.opacity == 1 && onPhone){
        iconThing.style.opacity = 0
    }
    
})

joinRoom.addEventListener("click", (event) => {
    if (roomInput.value.length == 5) {
        localStorage.setItem("roomNumber", roomInput.value);
        socket.emit("joinRoom", {joinRoom: roomInput.value})
        setTimeout(()=>{
            window.location.href = "https://"+ window.location.hostname +"/customRoom"
        },500)}else {
            send_system_message("Room number has to be 5 characters long!")
        }
})

textarea.addEventListener('focus', () => {
    textarea.addEventListener('keydown', (event) => {
        if (event.ctrlKey && event.key === 'v') {
            if (canSend){
                canSend = false
                pasteImage()
                setTimeout(funtion =>{
                    canSend = true
                },1200)
            }
        }
    });
});

textarea.addEventListener('blur', () => {
    textarea.removeEventListener('keydown', () => {});
});
    </script>
    <!--<script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js" data-name="bmc-button" data-slug="ItsbaileyX3525" data-color="#FF5F5F" data-emoji="☕"  data-font="Lato" data-text="Buy me a coffee" data-outline-color="#000000" data-font-color="#ffffff" data-coffee-color="#FFDD00" ></script>-->
</body>
</html>
