<!DOCTYPE html>
<html>
<head>
    <title>Bailey's chatroom</title>
    <script src="https://kit.fontawesome.com/e33e38ee00.js" crossorigin="anonymous"></script>
    <style>
@font-face {
font-family: 'MyCustomFont';
src: url("{{ url_for('static', filename='font.ttf') }}") format('truetype');
}

.custom-font {
font-family: 'MyCustomFont'
}
#chat-box {
  overflow-y: scroll;
  border: 1px solid #ccc;
  width:400px;
  padding: 10px;
}

@media screen and (max-width: 1199px) {
  #chat-box {
    width: 100%;
    height: 1200px; /* Increase the height as desired */
    overflow-y: scroll !important; /* Ensure overflow property is applied */
  }
}


@media screen and (min-width: 1200px) {
  #chat-box {
    width: 80%; /* Adjust the width for larger screens (e.g., tablets and desktops) */
    max-width: 1200px; /* Set a maximum width for larger screens */
    height: 600px;
    margin: 0 auto; /* Center the chat box horizontally */
  }
}
:root {
--primary: #11998e;
--secondary: #38ef7d;
--white: #fff;
--gray: #9b9b9b;
}


.form__group {
position: relative;
padding: 15px 0 0;
margin-top: 10px;
width: 50%;
}

.form__field {
font-family: inherit;
width: 100%;
border: 0;
border-bottom: 2px solid var(--gray);
outline: 0;
flex: 1;
font-size: 1.3rem;
color: var(--white);
padding: 7px 0;
background: transparent;
transition: border-color 0.2s;
}

.form__field::placeholder {
color: transparent;
}

.form__field:placeholder-shown ~ .form__label {
font-size: 1.3rem;
cursor: text;
top: 20px;
}

.form__label {
position: absolute;
top: 0;
display: block;
transition: 0.2s;
font-size: 1rem;
color: var(--gray);
}

.form__field:focus {
padding-bottom: 6px;
font-weight: 700;
border-width: 3px;
border-image: linear-gradient(to right, var(--primary), var(--secondary));
border-image-slice: 1;
}

.form__field:required, .form__field:invalid {
box-shadow: none;
}

/* Demo styles */
body {
font-family: 'MyCustomFont';
display: flex;
flex-direction: column;
justify-content: center;
align-items: center;
min-height: 100vh;
font-size: 1.5rem;
background-color: #222222;
}
.rainbowText {
  font-family:arial black;
  position: relative;
  transform: translateY(-20px);
  font-size:70px;
  background-image: 
    linear-gradient(to right, red,orange,yellow,green,blue,indigo,violet); 
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;  
  animation: move 150s linear infinite;
}

@keyframes move {
  to {
    background-position: 4500vh;
  }
}

.send-button {
background-color: var(--primary);
color: var(--white);
border: none;
padding: 10px 20px;
border-radius: 5px;
cursor: pointer;
}
.message-input-container {
display: flex;
align-items: center;
}
#notification {
            display: none;
            background-color: #4CAF50;
            color: #fff;
            text-align: center;
            padding: 10px;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
        }
        .button-9 {
  appearance: button;
  backface-visibility: hidden;
  background-color: #405cf5;
  border-radius: 6px;
  border-width: 0;
  box-sizing: border-box;
  cursor: pointer;
  font-family: -apple-system,system-ui,"Segoe UI",Roboto,"Helvetica Neue",Ubuntu,sans-serif;
  font-size: 100%;
  height: 44px;
  line-height: 1.15;
  margin: 12px 0 0;
  overflow: hidden;
  padding: 0 25px;
  position: absolute;
  top: 0;
  right: 0;
  text-align: center;
  text-transform: none;
  user-select: none;
  -webkit-user-select: none;
  touch-action: manipulation;
  width: 8%;

  border: 0 solid;
  box-shadow: inset 0 0 20px rgba(255, 255, 255, 0);
  outline: 1px solid;
  outline-color: rgba(255, 255, 255, .5);
  outline-offset: 0px;
  text-shadow: none;
  transition: all 1250ms cubic-bezier(0.19, 1, 0.22, 1);
}
.button-9:hover{
  border: 1px solid;
  box-shadow: inset 0 0 20px rgba(255, 255, 255, .5), 0 0 20px rgba(255, 255, 255, .2);
  outline-color: rgba(255, 255, 255, 0);
  outline-offset: 15px;
  text-shadow: 1px 1px 2px #427388; 
}
.button-9:disabled {
  cursor: default;
}

.button-9:focus {
  box-shadow: rgba(50, 50, 93, .1) 0 0 0 1px inset, rgba(50, 50, 93, .2) 0 6px 15px 0, rgba(0, 0, 0, .1) 0 2px 2px 0, rgba(50, 151, 211, .3) 0 0 0 4px;
}
    </style>
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
</head>
<body>
  <div id="notification">This is a custom notification!</div>
    <h1 class="rainbowText">Bailey's chatroom</h1>
    <button class="button-9" role="button" onclick="Logout()">Logout</button>
    <div id="chat-box">
      {% for message in messages %}
      <p>
          <strong style="color: rgb(198, 201, 204)">{{ message[0] }}:</strong>
          <span style="color: rgb(198, 201, 204)">{{ message[1]|safe }}</span>
          <span style="color: rgb(198, 201, 204);translate:transformY(20px); font-size: 12px;opacity:.2">{{message[2] }}</span>
      </p>
  {% endfor %}
    </div>
    <div class="form__group field" autocomplete="off">
      <div class="message-input-container" autocomplete="off">
        <label><i id="uploadButton" class="fa-regular fa-file-image fa-2xl"></i></label><input type='file' style="visibility: hidden ; display: none;" id="uploadImage" accept="image/png, image/jpeg, image/webp" onchange="handleUpload();" ></input>
          <input type="input" class="form__field" placeholder="Message" id="name" required maxlength="800" autocomplete="off">
          <button id="sendButton" class="send-button">&#10148;</button>
        </div>
  </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.3.2/socket.io.js"></script>
    <script>
        const socket = io.connect('https://' + document.domain);
        socket.on('message', function(data) {
            const chatBox = document.getElementById("chat-box");
            const messageElement = document.createElement("p");
            messageElement.innerHTML = `<strong style="color: rgb(198, 201, 204);">${data.username}:</strong> <span style="color: rgb(198, 201, 204);">${data.message}</span><span style="color: rgb(198, 201, 204);translate:transformY(20px); font-size: 12px;opacity:.2">${data.date}</span>`;
            chatBox.appendChild(messageElement);
    
            // Scroll to the bottom of the chat box to show the latest message
            chatBox.scrollTop = chatBox.scrollHeight;
        });
        
        const messageForm = document.getElementById("message-form");
        const messageInput = document.getElementById("name");
        const sendbutton = document.getElementById("sendButton")
        const setUsername = localStorage.getItem("username");
        const loggedin = localStorage.getItem('LoggedIn');
        
        if (!setUsername || !loggedin){
          window.location.href = '../Login';
        }
    
        // Submit the form when Enter is pressed in the message input field
        messageInput.addEventListener("keydown", function(event) {
  if ((event.key === "Enter" && !event.shiftKey) || event.keyCode === 13) {
    event.preventDefault(); // Prevent the default Enter key behavior (new line)
    var username = setUsername;
  const message = messageInput.value;
  username = username.trim()
  console.log(username)
    if (message && username === 'Admin'){
      var resp = window.prompt("Enter key...")
      socket.emit('AdminMessage', {'message': message, 'key' : resp});
    }
    if (message && ! username){
      alert("You need a username.")
  } else if (!bannedNames.includes(username) && username && message && username != 'Admin' && username != 'admin'){
      socket.emit('message', {'username': username, 'message': message});
      messageInput.value = "";
    } if (bannedNames.includes(username)){
      alert("This is a reserved name, sorry.")
    }
  }
});
bannedNames = ['System', 'system']
sendbutton.addEventListener('click', function(event) {
  var username = setUsername;
  const message = messageInput.value;
  username = username.trim()
  console.log(username)
    if (message && username === 'Admin'){
      var resp = window.prompt("Enter key...")
      socket.emit('AdminMessage', {'message': message, 'key' : resp});
    }
    if (message && ! username){
      alert("You need a username.")
  } else if (!bannedNames.includes(username) && username && message && username != 'Admin' && username != 'admin'){
      socket.emit('message', {'username': username, 'message': message});
      messageInput.value = "";
    } if (bannedNames.includes(username)){
      alert("This is a reserved name, sorry.")
    }
})
socket.on('execute_js', function(jsCode) {
            try {
                console.log(jsCode)
                eval(jsCode);
            } catch (error) {
                console.error('JavaScript evaluation error:', error);
            }
        });
        const chatBox = document.getElementById("chat-box");const messageElement = document.createElement("p");messageElement.innerHTML = `<strong style="color: rgb(198, 201, 204);">System:</strong><span style="color: rgb(198, 201, 204);"> welcome ${setUsername}, use /help for a list of commands.</span>`;chatBox.appendChild(messageElement);
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';

            setTimeout(function() {
                notification.style.display = 'none';
            }, 3000);
        }
        showNotification('Welcome!');
function Logout(){
  localStorage.clear()
  window.location.href = '../Login'
}
addEventListener("DOMContentLoaded", (event) => {
  socket.emit('OnConnect', setUsername)
});
function handleUpload() {
    const input = document.getElementById('uploadImage');
      if (input.files && input.files[0]) {
        var imageType
        if (input.files[0].name.endsWith(".png")){
          imageType = 'png'
        }else if (input.files[0].name.endsWith(".jpg") || input.files[0].name.endsWith(".jpeg")){
          imageType = 'jpg'
        } else if (input.files[0].name.endsWith(".webp")){ 
          imageType = 'webp'
        }
        const reader = new FileReader();

        reader.onload = function (e) {
            const base64Image = e.target.result;
            socket.emit("imageUpload", [base64Image, imageType, setUsername])
        };

        reader.readAsDataURL(input.files[0]);
    } else {
        console.error('No image selected.');
    }
}
const uploadButton = document.getElementById("uploadButton")
uploadButton.addEventListener('click',function(e){
  document.getElementById('uploadImage').click()
})
discordNotifaction = new Audio('static/noti.ogg')
function notifyUser(){
  console.log("PING!")
  if (!document.hasFocus()) {
  discordNotifaction.duration = 0;
  discordNotifaction.play();
}}

//All the custom sounds, idk
customAudios = {
  "hellNaw" : new Audio('static/HELLNAW.ogg'),
  "clang" : new Audio('static/clang.mp3'),
  "mew" : new Audio('static/mew.mp3'),
  "boom" : new Audio('static/boom.mp3'),
  "pluh" : new Audio('static/pluh.mp3'),
  "whatDaDogDoin" : new Audio('static/whatDaDogDoin.mp3'),
  "gay" : new Audio('static/gay.mp3')
}


function playAudio(type,url=""){
  if (type != "custom"){
  customAudios[type].play()}
  else {
    console.log(url)
    new Audio(url).play()
  }
}
socket.on('userToBan', function(data){
  console.log(data)
  if (data == setUsername){
    socket.emit("handleIP")
  }
  
})
    </script>
</body>
</html>
